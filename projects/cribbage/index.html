<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Cribbage Scoring System</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, #1b5e20 0%, #2e7d32 50%, #388e3c 100%);
      min-height: 100vh;
      overflow: hidden;
    }

    #root {
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    .header {
      background: rgba(0, 0, 0, 0.3);
      color: white;
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .header h1 {
      font-size: 1.5rem;
      font-weight: 700;
    }

    .theme-selector {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .theme-selector select {
      padding: 0.5rem;
      border-radius: 0.5rem;
      border: none;
      background: rgba(255, 255, 255, 0.9);
      cursor: pointer;
      font-size: 0.9rem;
    }

    .btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
      font-size: 0.9rem;
    }

    .btn:active {
      transform: scale(0.95);
    }

    .btn-primary {
      background: #1976d2;
      color: white;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .btn-primary:hover {
      background: #1565c0;
    }

    .btn-secondary {
      background: #616161;
      color: white;
    }

    .btn-secondary:hover {
      background: #424242;
    }

    /* Main Layout */
    .game-screen {
      flex: 1;
      display: flex;
      gap: 1rem;
      padding: 1rem;
      overflow: hidden;
    }

    /* Player Panel */
    .player-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: white;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      min-height: 0;
    }

    .player-info {
      text-align: center;
      padding-bottom: 1rem;
      border-bottom: 2px solid #e0e0e0;
      margin-bottom: 1rem;
    }

    .player-name {
      font-size: 1.5rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .dealer-badge {
      background: #ffc107;
      color: #000;
      padding: 0.25rem 0.5rem;
      border-radius: 0.5rem;
      font-size: 0.75rem;
      font-weight: 700;
    }

    .score-display {
      margin: 1rem 0;
    }

    .score-number {
      font-size: 4rem;
      font-weight: 700;
    }

    .score-number.player1 {
      color: #d32f2f;
    }

    .score-number.player2 {
      color: #1976d2;
    }

    .last-points-inline {
      font-size: 2.8rem;
      font-weight: 400;
    }

    .score-diff {
      font-size: 1.8rem;
      color: #666;
      margin-top: 0.5rem;
      font-weight: 600;
    }

    .progress-bar-container {
      width: 100%;
      max-width: 121px;
      margin: 1rem auto 0;
      background: #e0e0e0;
      border-radius: 4px;
      overflow: hidden;
      height: 16px;
      position: relative;
    }

    .progress-bar {
      height: 8px;
      transition: width 0.3s ease;
      position: absolute;
      left: 0;
    }

    .progress-bar-player1 {
      background: #d32f2f;
      top: 0;
    }

    .progress-bar-player2 {
      background: #1976d2;
      bottom: 0;
    }

    .last-points {
      font-size: 0.9rem;
      color: #1976d2;
      font-weight: 600;
      margin-top: 0.25rem;
    }

    .win-stats {
      font-size: 0.9rem;
      color: #666;
      margin-top: 0.5rem;
    }

    /* Scoring Keypad */
    .scoring-keypad {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .keypad-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: #666;
      margin-bottom: 0.5rem;
    }

    .input-display {
      background: #f5f5f5;
      border-radius: 0.5rem;
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
      font-weight: 700;
      color: #333;
      min-height: 3rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .keypad-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
    }

    .keypad-btn {
      padding: 1.25rem;
      font-size: 1.5rem;
      font-weight: 700;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      background: white;
      color: #333;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      transition: all 0.2s;
    }

    .keypad-btn:hover {
      background: #f5f5f5;
    }

    .keypad-btn:active {
      transform: scale(0.95);
    }

    .keypad-btn-wide {
      grid-column: span 2;
    }

    .keypad-btn-full {
      grid-column: span 3;
    }

    .keypad-grid-three {
      grid-template-columns: repeat(3, 1fr);
    }

    .add-points-btn {
      background: #1976d2;
      color: white;
      padding: 1rem;
      font-size: 1.1rem;
    }

    .add-points-btn:hover {
      background: #1565c0;
    }

    .undo-btn {
      background: #616161;
      color: white;
      padding: 0.75rem;
      font-size: 1rem;
    }

    /* Board */
    .board-container {
      flex: 2;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    /* Classic Board */
    .classic-board {
      width: 100%;
      height: 100%;
      background:
        repeating-linear-gradient(
          90deg,
          #c19a6b 0px,
          #d4a574 2px,
          #c19a6b 4px,
          #b8926a 6px,
          #c19a6b 8px,
          #d4a574 10px,
          #c19a6b 12px
        ),
        linear-gradient(135deg, #d4a574 0%, #c19a6b 50%, #b8926a 100%);
      border-radius: 0.75rem;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      box-shadow:
        inset 0 2px 8px rgba(0, 0, 0, 0.2),
        0 4px 12px rgba(0, 0, 0, 0.3);
      border: 3px solid #8b7355;
    }

    .board-lanes {
      display: flex;
      gap: 3rem;
      justify-content: center;
      align-items: stretch;
      flex: 1;
      min-height: 0;
    }

    .lanes-group {
      display: flex;
      gap: 0.75rem;
    }

    .board-lane {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      min-height: 0;
    }

    .center-area {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      padding: 0 1rem;
      min-width: 120px;
    }

    .board-logo {
      width: 180px;
      height: auto;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
    }

    .board-stats {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .board-stat-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .board-stat-label {
      font-size: 1rem;
      font-weight: 600;
      color: #5D4E37;
      min-width: 4rem;
    }

    .board-scores {
      display: flex;
      flex-direction: row;
      gap: 0.5rem;
      text-align: center;
    }

    .board-score {
      font-size: 1.5rem;
      font-weight: bold;
      padding: 0.3rem 0.6rem;
      border-radius: 0.5rem;
      background: rgba(255, 255, 255, 0.2);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      min-width: 2.5rem;
    }

    .board-score.player1-score {
      color: #dc2626;
    }

    .board-score.player2-score {
      color: #2563eb;
    }

    .hole {
      width: 0.65rem;
      height: 0.65rem;
      background: #654321;
      border-radius: 50%;
      position: relative;
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.6);
      transition: all 0.2s;
      flex-shrink: 0;
    }

    .hole.group-end {
      margin-bottom: 0.4rem;
    }

    .finish-hole-container {
      display: flex;
      justify-content: center;
      padding-top: 1rem;
      margin-top: 0.5rem;
      border-top: 2px solid rgba(139, 115, 85, 0.3);
    }

    .peg {
      position: absolute;
      width: 1rem;
      height: 1rem;
      border-radius: 50%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .peg.player1 {
      background: #dc2626;
    }

    .peg.player2 {
      background: #2563eb;
    }

    .peg.leading {
      box-shadow: 0 0 0 2px #ffc107, 0 2px 4px rgba(0, 0, 0, 0.3);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    /* Themed Boards */
    .themed-board {
      width: 100%;
      height: 100%;
      position: relative;
    }

    .themed-board svg {
      width: 100%;
      height: 100%;
    }

    .themed-board.mountain {
      background: linear-gradient(to top, #2e7d32 0%, #78909c 50%, white 100%);
      border-radius: 0.5rem;
    }

    .themed-board.skiing {
      background: linear-gradient(to bottom, white 0%, #bbdefb 50%, #2e7d32 100%);
      border-radius: 0.5rem;
    }

    .themed-board.moon {
      background: linear-gradient(to top, #1a237e 0%, #4a148c 50%, #000 100%);
      border-radius: 0.5rem;
    }

    .star {
      position: absolute;
      background: white;
      border-radius: 50%;
      animation: twinkle 3s infinite;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    /* Game Info */
    .game-info {
      text-align: center;
      background: rgba(0, 0, 0, 0.2);
      color: white;
      padding: 0.75rem;
      border-radius: 0.5rem;
      font-size: 0.9rem;
    }

    /* Setup Screen */
    .setup-screen {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .setup-card {
      background: white;
      border-radius: 1rem;
      padding: 2rem;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    }

    .setup-card h2 {
      text-align: center;
      font-size: 2rem;
      margin-bottom: 1.5rem;
      color: #333;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #333;
    }

    .form-group input {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid #e0e0e0;
      border-radius: 0.5rem;
      font-size: 1rem;
    }

    .form-group input:focus {
      outline: none;
      border-color: #1976d2;
    }

    .start-btn {
      width: 100%;
      padding: 1rem;
      margin-top: 1rem;
      background: #1976d2;
      color: white;
      border: none;
      border-radius: 0.5rem;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }

    .start-btn:hover {
      background: #1565c0;
    }

    .how-to-play {
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 2px solid #e0e0e0;
    }

    .how-to-play h3 {
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #333;
    }

    .how-to-play ul {
      list-style: none;
      font-size: 0.9rem;
      color: #666;
    }

    .how-to-play li {
      margin-bottom: 0.25rem;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 1rem;
    }

    .modal-content {
      background: white;
      border-radius: 1rem;
      padding: 2rem;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }

    .modal-content h2 {
      font-size: 2rem;
      margin-bottom: 1rem;
      text-align: center;
    }

    .trophy {
      text-align: center;
      font-size: 4rem;
      margin-bottom: 1rem;
    }

    .winner-name {
      font-size: 2.5rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 1rem;
      color: #1976d2;
    }

    .skunk-message {
      text-align: center;
      font-size: 1.5rem;
      font-weight: 700;
      color: #ffc107;
      margin-bottom: 1rem;
    }

    .final-score {
      text-align: center;
      font-size: 1.2rem;
      color: #666;
      margin-bottom: 1.5rem;
    }

    .session-standings {
      background: #f5f5f5;
      border-radius: 0.5rem;
      padding: 1rem;
      margin-bottom: 1.5rem;
    }

    .session-standings h3 {
      font-weight: 600;
      margin-bottom: 0.5rem;
      text-align: center;
    }

    .session-standings .score {
      text-align: center;
      font-size: 1.2rem;
      font-weight: 700;
    }

    .modal-actions {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .modal-btn {
      width: 100%;
      padding: 1rem;
      border: none;
      border-radius: 0.5rem;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .modal-btn.primary {
      background: #1976d2;
      color: white;
    }

    .modal-btn.primary:hover {
      background: #1565c0;
    }

    .modal-btn.secondary {
      background: #e0e0e0;
      color: #333;
    }

    .modal-btn.secondary:hover {
      background: #d0d0d0;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // ============ API CONFIGURATION ============
    const API_BASE = '/projects/cribbage/api';

    const api = {
      request: async (endpoint, options = {}) => {
        const response = await fetch(`${API_BASE}${endpoint}`, {
          credentials: 'include',
          headers: {
            'Content-Type': 'application/json',
            ...options.headers
          },
          ...options
        });

        // Get the response text first to handle parsing errors
        const text = await response.text();
        console.log('üì• Response text:', text.substring(0, 500));

        let data;
        try {
          data = JSON.parse(text);
        } catch (e) {
          console.error('‚ùå JSON parse error:', e);
          console.error('‚ùå Response was:', text);
          throw new Error(`Server returned invalid JSON: ${text.substring(0, 200)}`);
        }

        if (!response.ok) {
          throw new Error(data.error || data.message || 'Request failed');
        }

        return data.data || data;
      },

      createSession: (sessionData) => {
        console.log('üî∑ api.createSession called with:', sessionData);
        console.log('üî∑ Making POST request to:', `${API_BASE}/sessions.php`);
        return api.request('/sessions.php', {
          method: 'POST',
          body: JSON.stringify(sessionData)
        });
      },

      createGame: (sessionId) => {
        return api.request('/games.php', {
          method: 'POST',
          body: JSON.stringify({ session_id: sessionId })
        });
      },

      addMove: (gameId, moveData) => {
        return api.request('/moves.php', {
          method: 'POST',
          body: JSON.stringify({ game_id: gameId, ...moveData })
        });
      },

      undoMove: (moveId) => {
        return api.request(`/moves.php?id=${moveId}`, {
          method: 'DELETE'
        });
      },

      // Friends API
      friends: {
        list: () => {
          return api.request('/friends.php', { method: 'GET' });
        },
        add: (data) => {
          return api.request('/friends.php', {
            method: 'POST',
            body: JSON.stringify(data)
          });
        },
        remove: (playerId) => {
          return api.request(`/friends.php?player_id=${playerId}`, {
            method: 'DELETE'
          });
        }
      },

      // Players API
      players: {
        check: (name) => {
          return api.request(`/players.php?check=${encodeURIComponent(name)}`, {
            method: 'GET'
          });
        },
        create: (data) => {
          return api.request('/players.php', {
            method: 'POST',
            body: JSON.stringify(data)
          });
        }
      }
    };

    // ============ COMPONENTS ============

    // New Game Setup Component
    function NewGameSetup({ onStart, onManageFriends }) {
      const [player1Name, setPlayer1Name] = useState('');
      const [player2Name, setPlayer2Name] = useState('');
      const [friends, setFriends] = useState([]);
      const [isLoadingFriends, setIsLoadingFriends] = useState(true);
      const [showDealerSelect, setShowDealerSelect] = useState(false);
      const [dealerAnnouncement, setDealerAnnouncement] = useState('');

      // Load friends on mount
      useEffect(() => {
        const loadFriends = async () => {
          setIsLoadingFriends(true);
          try {
            const response = await api.friends.list();
            setFriends(response.friends || []);
          } catch (error) {
            console.error('Failed to load friends:', error);
          }
          setIsLoadingFriends(false);
        };
        loadFriends();
      }, []);

      const handleSubmit = (e) => {
        console.log('üîµ Form submitted!', { player1Name, player2Name });
        e.preventDefault();
        if (player1Name.trim() && player2Name.trim()) {
          console.log('üü¢ Player names valid, showing dealer selection...');
          setShowDealerSelect(true);
        } else {
          console.log('üî¥ Player names invalid!');
        }
      };

      const handleDealerChoice = (dealer) => {
        let chosenDealer;
        let dealerName;

        if (dealer === 'random') {
          chosenDealer = Math.random() < 0.5 ? 1 : 2;
          dealerName = chosenDealer === 1 ? player1Name.trim() : player2Name.trim();
          setDealerAnnouncement(`${dealerName} will deal first!`);
        } else {
          chosenDealer = dealer;
          onStart(player1Name.trim(), player2Name.trim(), chosenDealer === 1);
          setShowDealerSelect(false);
        }
      };

      const handleAnnouncementOk = () => {
        const dealer = dealerAnnouncement.includes(player1Name.trim()) ? 1 : 2;
        onStart(player1Name.trim(), player2Name.trim(), dealer === 1);
        setDealerAnnouncement('');
        setShowDealerSelect(false);
      };

      const addFriendToSlot = (friend, slot) => {
        if (slot === 1) {
          setPlayer1Name(friend.name);
        } else {
          setPlayer2Name(friend.name);
        }
      };

      return (
        <div className="setup-screen">
          <div className="setup-card">
            <h2>New Cribbage Game</h2>
            <form onSubmit={handleSubmit}>
              <div className="form-group">
                <label>Player 1 Name</label>
                <input
                  type="text"
                  value={player1Name}
                  onChange={(e) => setPlayer1Name(e.target.value)}
                  placeholder="Enter player 1 name"
                  required
                />
              </div>
              <div className="form-group">
                <label>Player 2 Name</label>
                <input
                  type="text"
                  value={player2Name}
                  onChange={(e) => setPlayer2Name(e.target.value)}
                  placeholder="Enter player 2 name"
                  required
                />
              </div>

              {!isLoadingFriends && friends.length > 0 && (
                <div style={{ marginBottom: '20px' }}>
                  <span style={{ fontSize: '14px', color: '#666', marginBottom: '8px', display: 'block' }}>Quick select from friends:</span>
                  <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>
                    {friends.map((friend) => (
                      <button
                        key={friend.id}
                        type="button"
                        className="btn btn-secondary"
                        onClick={() => {
                          // Add to next empty slot
                          if (!player1Name) {
                            addFriendToSlot(friend, 1);
                          } else if (!player2Name) {
                            addFriendToSlot(friend, 2);
                          } else {
                            // Both filled, replace player 2
                            addFriendToSlot(friend, 2);
                          }
                        }}
                        style={{ padding: '6px 12px', fontSize: '14px' }}
                      >
                        {friend.name}
                      </button>
                    ))}
                  </div>
                </div>
              )}

              <button type="submit" className="start-btn">
                Start Game
              </button>
              <button type="button" className="btn btn-secondary" onClick={onManageFriends} style={{ marginTop: '10px', width: '100%' }}>
                Manage Friends
              </button>
            </form>
            <div className="how-to-play">
              <h3>How to Play:</h3>
              <ul>
                <li>‚Ä¢ First player to 121 points wins</li>
                <li>‚Ä¢ Win before opponent reaches 90 = Skunk (2 game wins)</li>
                <li>‚Ä¢ Use the keypad to enter points scored</li>
                <li>‚Ä¢ Track is completed twice (60 points each lap) + 1 point</li>
              </ul>
            </div>

            {showDealerSelect && !dealerAnnouncement && (
              <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, backgroundColor: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000 }}>
                <div style={{ backgroundColor: 'white', padding: '24px', borderRadius: '8px', maxWidth: '400px', textAlign: 'center' }}>
                  <h3 style={{ marginBottom: '20px' }}>Who will deal first?</h3>
                  <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                    <button className="btn start-btn" onClick={() => handleDealerChoice(1)} style={{ width: '100%' }}>
                      {player1Name.trim()}
                    </button>
                    <button className="btn start-btn" onClick={() => handleDealerChoice(2)} style={{ width: '100%' }}>
                      {player2Name.trim()}
                    </button>
                    <button className="btn btn-secondary" onClick={() => handleDealerChoice('random')} style={{ width: '100%' }}>
                      Random
                    </button>
                  </div>
                </div>
              </div>
            )}

            {dealerAnnouncement && (
              <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, backgroundColor: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000 }}>
                <div style={{ backgroundColor: 'white', padding: '24px', borderRadius: '8px', maxWidth: '400px', textAlign: 'center' }}>
                  <h3 style={{ marginBottom: '20px', fontSize: '24px' }}>{dealerAnnouncement}</h3>
                  <button className="btn start-btn" onClick={handleAnnouncementOk} style={{ width: '100%' }}>
                    OK
                  </button>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    // Friends Screen Component
    function FriendsScreen({ onBack }) {
      const [friends, setFriends] = useState([]);
      const [isLoading, setIsLoading] = useState(true);
      const [isAdding, setIsAdding] = useState(false);
      const [newFriendName, setNewFriendName] = useState('');
      const [confirmPlayer, setConfirmPlayer] = useState(null);

      // Load friends on mount
      useEffect(() => {
        const loadFriends = async () => {
          setIsLoading(true);
          try {
            const response = await api.friends.list();
            setFriends(response.friends || []);
          } catch (error) {
            console.error('Failed to load friends:', error);
          }
          setIsLoading(false);
        };
        loadFriends();
      }, []);

      const addFriend = async () => {
        const name = newFriendName.trim();
        if (!name) return;

        // Check if already in friends list
        if (friends.some(f => f.name.toLowerCase() === name.toLowerCase())) {
          alert('This player is already in your friends list');
          return;
        }

        setIsAdding(true);
        try {
          // Check if player exists
          const checkResponse = await api.players.check(name);

          if (checkResponse.exists) {
            // Player exists - ask for confirmation
            setConfirmPlayer({
              ...checkResponse.player,
              inputName: name
            });
          } else {
            // Create new player and add as friend
            const result = await api.friends.add({ name });
            setFriends([...friends, result.friend]);
            setNewFriendName('');
          }
        } catch (error) {
          if (error.message.includes('already exists')) {
            // Server returned conflict - extract player info from error
            alert('A player with this name already exists. Please choose a different name or confirm if this is the same player.');
          } else {
            alert(`Error adding friend: ${error.message}`);
          }
        }
        setIsAdding(false);
      };

      const confirmExistingPlayer = async () => {
        try {
          const result = await api.friends.add({ player_id: confirmPlayer.id });
          setFriends([...friends, result.friend]);
          setConfirmPlayer(null);
          setNewFriendName('');
        } catch (error) {
          alert(`Error adding friend: ${error.message}`);
        }
      };

      const removeFriend = async (friend) => {
        if (!confirm(`Remove ${friend.name} from your friends?`)) return;
        try {
          await api.friends.remove(friend.id);
          setFriends(friends.filter(f => f.id !== friend.id));
        } catch (error) {
          alert(`Error removing friend: ${error.message}`);
        }
      };

      return (
        <div className="setup-screen">
          <div className="setup-card">
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>
              <h2>Friends</h2>
              <button className="btn btn-secondary" onClick={onBack}>Back</button>
            </div>

            <div style={{ display: 'flex', gap: '12px', marginBottom: '24px' }}>
              <input
                type="text"
                value={newFriendName}
                onChange={(e) => setNewFriendName(e.target.value)}
                onKeyPress={(e) => e.key === 'Enter' && addFriend()}
                placeholder="Add friend name"
                style={{ flex: 1, padding: '10px', fontSize: '16px', border: '1px solid #ccc', borderRadius: '4px' }}
              />
              <button className="btn start-btn" onClick={addFriend} disabled={isAdding} style={{ padding: '10px 20px' }}>
                {isAdding ? 'Adding...' : 'Add'}
              </button>
            </div>

            <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
              {isLoading ? (
                <p style={{ color: '#666', textAlign: 'center' }}>Loading friends...</p>
              ) : friends.length === 0 ? (
                <p style={{ color: '#666', textAlign: 'center' }}>No friends added yet. Add people you play with regularly!</p>
              ) : (
                friends.map((friend) => (
                  <div key={friend.id} style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '12px', border: '1px solid #e0e0e0', borderRadius: '4px', backgroundColor: '#f9f9f9' }}>
                    <div>
                      <strong>{friend.name}</strong>
                      {friend.statistics && (
                        <span style={{ fontSize: '14px', color: '#666', marginLeft: '10px' }}>
                          {friend.statistics.total_games} games, {friend.statistics.games_won} won
                        </span>
                      )}
                    </div>
                    <button className="btn btn-secondary" onClick={() => removeFriend(friend)} style={{ padding: '6px 12px', fontSize: '14px' }}>
                      Remove
                    </button>
                  </div>
                ))
              )}
            </div>

            {confirmPlayer && (
              <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, backgroundColor: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000 }}>
                <div style={{ backgroundColor: 'white', padding: '24px', borderRadius: '8px', maxWidth: '400px' }}>
                  <h3>Player Already Exists</h3>
                  <p>A player named <strong>{confirmPlayer.name}</strong> already exists.</p>
                  {confirmPlayer.total_games > 0 && (
                    <p>They've played {confirmPlayer.total_games} game(s).</p>
                  )}
                  <p>Is this the same player?</p>
                  <div style={{ display: 'flex', gap: '12px', marginTop: '20px' }}>
                    <button className="btn start-btn" onClick={confirmExistingPlayer} style={{ flex: 1 }}>
                      Yes, same player
                    </button>
                    <button className="btn btn-secondary" onClick={() => setConfirmPlayer(null)} style={{ flex: 1 }}>
                      No, different player
                    </button>
                  </div>
                  <p style={{ fontSize: '14px', color: '#666', marginTop: '12px' }}>
                    If different, please use a unique name (e.g., "John S." or "John 2")
                  </p>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    // Scoring Keypad Component
    function ScoringKeypad({ onAddPoints, onUndo }) {
      const [prefix, setPrefix] = useState(null); // null, '1-', or '2-'

      const handleDigit = (digit) => {
        if (prefix) {
          // Combine prefix with digit
          const prefixValue = prefix === '1-' ? 10 : 20;
          const points = prefixValue + digit;

          // Validate: 19 is impossible in cribbage
          if (points === 19) {
            alert('19 is not a valid cribbage score!');
            setPrefix(null);
            return;
          }

          // Add the points and clear prefix
          onAddPoints(points);
          setPrefix(null);
        } else {
          // Single digit - add immediately
          onAddPoints(digit);
        }
      };

      const handleZero = () => {
        if (prefix) {
          // Makes 10 or 20
          const points = prefix === '1-' ? 10 : 20;
          onAddPoints(points);
          setPrefix(null);
        }
        // Ignore 0 if no prefix (can't score 0 points)
      };

      const handlePrefix = (newPrefix) => {
        setPrefix(newPrefix);
      };

      const getDisplayText = () => {
        if (prefix) {
          return `${prefix}_`; // Show prefix waiting for digit
        }
        return ''; // Remove "Ready" display
      };

      return (
        <div className="scoring-keypad">
          <div className="input-display">{getDisplayText()}</div>

          <div className="keypad-grid">
            {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(n => (
              <button key={n} className="keypad-btn" onClick={() => handleDigit(n)}>
                {n}
              </button>
            ))}
          </div>

          <div className="keypad-grid keypad-grid-three">
            <button className="keypad-btn" onClick={handleZero}>0</button>
            <button className="keypad-btn" onClick={() => handlePrefix('1-')}>
              1-
            </button>
            <button className="keypad-btn" onClick={() => handlePrefix('2-')}>
              2-
            </button>
          </div>

          <div className="keypad-grid">
            <button className="keypad-btn keypad-btn-full undo-btn" onClick={onUndo}>
              Undo
            </button>
          </div>
        </div>
      );
    }

    // Player Panel Component
    function PlayerPanel({ player, name, score, lastPoints, isLeading, scoreDiff, player1Score, player2Score, onAddPoints, onUndo }) {
      const playerColor = player === '1' ? 'player1' : 'player2';

      // Calculate progress bar widths (max score is 121)
      const player1Percentage = (player1Score / 121) * 100;
      const player2Percentage = (player2Score / 121) * 100;

      return (
        <div className="player-panel">
          <div className="player-info">
            <div className="player-name">
              {name}
            </div>
            <div className="score-display">
              <div className={`score-number ${playerColor}`}>
                {score}<span className="last-points-inline"> (+{lastPoints})</span>
              </div>
              <div className="score-diff">
                {scoreDiff > 0 ? (isLeading ? `Leads By: ${scoreDiff}` : `Trails By: ${scoreDiff}`) : 'Tied'}
              </div>
              <div className="progress-bar-container">
                <div className="progress-bar progress-bar-player1" style={{ width: `${player1Percentage}%` }}></div>
                <div className="progress-bar progress-bar-player2" style={{ width: `${player2Percentage}%` }}></div>
              </div>
            </div>
          </div>
          <ScoringKeypad
            onAddPoints={onAddPoints}
            onUndo={onUndo}
          />
        </div>
      );
    }

    // Cribbage Board Component
    function CribbageBoard({ player1Score, player2Score, player1LastPoints, player2LastPoints, sessionWins, theme }) {
      // Map score (0-121) to physical hole position (1-121)
      // Holes 1-60 are reused for scores 1-60 and 61-120
      const scoreToHole = (score) => {
        if (score === 0) return 0;
        if (score === 121) return 121;
        if (score <= 60) return score;
        // Second lap: scores 61-120 map back to holes 1-60
        return score - 60;
      };

      const hasPlayer1Peg = (holePosition) => {
        const leadingHole = scoreToHole(player1Score);
        const trailingHole = scoreToHole(player1Score - player1LastPoints);
        return holePosition === leadingHole || (player1LastPoints > 0 && holePosition === trailingHole);
      };

      const hasPlayer2Peg = (holePosition) => {
        const leadingHole = scoreToHole(player2Score);
        const trailingHole = scoreToHole(player2Score - player2LastPoints);
        return holePosition === leadingHole || (player2LastPoints > 0 && holePosition === trailingHole);
      };

      const isLeadingPeg = (player, holePosition) => {
        const leadingHole = player === 1 ? scoreToHole(player1Score) : scoreToHole(player2Score);
        return holePosition === leadingHole;
      };

      const renderClassicBoard = () => {
        const renderHole = (pos, isGroupEnd, playerLane) => (
          <div key={`${playerLane}-${pos}`} className={`hole ${pos === 121 ? 'finish' : ''} ${isGroupEnd ? 'group-end' : ''}`}>
            {playerLane === 1 && hasPlayer1Peg(pos) && (
              <div className={`peg player1 ${isLeadingPeg(1, pos) ? 'leading' : ''}`} />
            )}
            {playerLane === 2 && hasPlayer2Peg(pos) && (
              <div className={`peg player2 ${isLeadingPeg(2, pos) ? 'leading' : ''}`} />
            )}
          </div>
        );

        // Build 4 lanes - each player gets their own complete track
        // Left double lane (1-30 up, 61-90 up):
        //   - Player 1 (red) left sub-lane
        //   - Player 2 (blue) right sub-lane
        // Right double lane (31-60 down, 91-120 down):
        //   - Player 1 (red) left sub-lane
        //   - Player 2 (blue) right sub-lane

        const player1LeftLane = [];  // Positions 1-30 (also used for 61-90)
        const player2LeftLane = [];  // Positions 1-30 (also used for 61-90)
        const player1RightLane = []; // Positions 31-60 (also used for 91-120)
        const player2RightLane = []; // Positions 31-60 (also used for 91-120)

        // Left lanes: positions 1-30 (displayed top to bottom)
        // These same holes are reused for positions 61-90 (second lap)
        for (let i = 30; i >= 1; i--) {
          const visualPos = 30 - i;
          player1LeftLane.push(renderHole(i, (visualPos + 1) % 5 === 0 && i !== 1, 1));
          player2LeftLane.push(renderHole(i, (visualPos + 1) % 5 === 0 && i !== 1, 2));
        }

        // Right lanes: positions 31-60 (displayed top to bottom)
        // These same holes are reused for positions 91-120 (second lap)
        for (let i = 31; i <= 60; i++) {
          const visualPos = i - 31;
          player1RightLane.push(renderHole(i, (visualPos + 1) % 5 === 0 && i !== 60, 1));
          player2RightLane.push(renderHole(i, (visualPos + 1) % 5 === 0 && i !== 60, 2));
        }

        console.log('Hole counts (each hole used twice for 2 laps):', {
          player1Left: player1LeftLane.length,
          player2Left: player2LeftLane.length,
          player1Right: player1RightLane.length,
          player2Right: player2RightLane.length,
          totalPhysicalHoles: player1LeftLane.length + player1RightLane.length + player2LeftLane.length + player2RightLane.length,
          note: 'Each hole represents 2 positions (e.g., hole 1 = positions 1 and 61)'
        });

        return (
          <div className="classic-board">
            <div className="board-lanes">
              <div className="lanes-group">
                <div className="board-lane player1-lane">{player1LeftLane}</div>
                <div className="board-lane player2-lane">{player2LeftLane}</div>
              </div>
              <div className="center-area">
                <img src="cribbage_logo.png" alt="Cribbage" className="board-logo" />
                <div className="board-stats">
                  <div className="board-stat-row">
                    <span className="board-stat-label">Points</span>
                    <div className="board-scores">
                      <div className="board-score player1-score">{player1Score}</div>
                      <div className="board-score player2-score">{player2Score}</div>
                    </div>
                  </div>
                  <div className="board-stat-row">
                    <span className="board-stat-label">Games</span>
                    <div className="board-scores">
                      <div className="board-score player1-score">{sessionWins?.player1 || 0}</div>
                      <div className="board-score player2-score">{sessionWins?.player2 || 0}</div>
                    </div>
                  </div>
                </div>
              </div>
              <div className="lanes-group">
                <div className="board-lane player1-lane">{player1RightLane}</div>
                <div className="board-lane player2-lane">{player2RightLane}</div>
              </div>
            </div>
            <div className="finish-hole-container">
              <div className="hole">
                {hasPlayer1Peg(121) && (
                  <div className={`peg player1 ${isLeadingPeg(1, 121) ? 'leading' : ''}`} />
                )}
                {hasPlayer2Peg(121) && (
                  <div className={`peg player2 ${isLeadingPeg(2, 121) ? 'leading' : ''}`} />
                )}
              </div>
            </div>
          </div>
        );
      };

      const getMountainPos = (score) => {
        const progress = score / 121;
        const y = 390 - (progress * 380);
        const x = 150 + Math.sin(progress * Math.PI * 2) * 40;
        return { x, y };
      };

      const getSkiingPos = (score) => {
        const progress = score / 121;
        const y = 10 + (progress * 380);
        const x = 150 + Math.sin(progress * Math.PI * 3) * 50;
        return { x, y };
      };

      const getMoonPos = (score) => {
        const progress = score / 121;
        const y = 390 - (progress * 380);
        const x = 150 + Math.sin(progress * Math.PI * 2) * 40;
        return { x, y };
      };

      const renderThemedBoard = () => {
        if (theme === 'mountain') {
          const p1Pos = getMountainPos(player1Score);
          const p2Pos = getMountainPos(player2Score);
          return (
            <div className="themed-board mountain">
              <svg viewBox="0 0 300 400" preserveAspectRatio="xMidYMid meet">
                <path d="M 10 390 Q 50 350, 90 310 Q 130 270, 170 230 Q 210 190, 150 150 Q 90 110, 130 70 Q 170 30, 150 10"
                  fill="none" stroke="#8B4513" strokeWidth="8" strokeDasharray="5,5" />
                <circle cx={p1Pos.x} cy={p1Pos.y} r="8" fill="#DC2626" />
                <circle cx={p2Pos.x + 15} cy={p2Pos.y} r="8" fill="#2563EB" />
                <text x="150" y="15" textAnchor="middle" fill="white" fontWeight="bold">‚õ∞Ô∏è 121</text>
              </svg>
            </div>
          );
        } else if (theme === 'skiing') {
          const p1Pos = getSkiingPos(player1Score);
          const p2Pos = getSkiingPos(player2Score);
          return (
            <div className="themed-board skiing">
              <svg viewBox="0 0 300 400" preserveAspectRatio="xMidYMid meet">
                <path d="M 150 10 Q 190 50, 210 90 Q 230 130, 180 170 Q 130 210, 170 250 Q 210 290, 150 330 Q 90 370, 150 390"
                  fill="none" stroke="#0EA5E9" strokeWidth="8" strokeDasharray="5,5" />
                <circle cx={p1Pos.x} cy={p1Pos.y} r="8" fill="#DC2626" />
                <circle cx={p2Pos.x + 15} cy={p2Pos.y} r="8" fill="#2563EB" />
                <text x="150" y="395" textAnchor="middle" fill="white" fontWeight="bold">üéø 121</text>
              </svg>
            </div>
          );
        } else if (theme === 'moon') {
          const p1Pos = getMoonPos(player1Score);
          const p2Pos = getMoonPos(player2Score);
          const stars = Array.from({ length: 50 }, (_, i) => ({
            left: `${(i * 37) % 100}%`,
            top: `${(i * 53) % 100}%`,
            width: `${1 + (i % 3)}px`,
            height: `${1 + (i % 3)}px`,
          }));
          return (
            <div className="themed-board moon">
              {stars.map((style, i) => (
                <div key={i} className="star" style={style} />
              ))}
              <svg viewBox="0 0 300 400" preserveAspectRatio="xMidYMid meet" style={{ position: 'relative', zIndex: 10 }}>
                <path d="M 150 390 Q 100 350, 120 310 Q 140 270, 100 230 Q 60 190, 100 150 Q 140 110, 120 70 Q 100 30, 150 10"
                  fill="none" stroke="#FCD34D" strokeWidth="4" strokeDasharray="3,3" opacity="0.5" />
                <text x={p1Pos.x} y={p1Pos.y} textAnchor="middle" fontSize="20">üöÄ</text>
                <text x={p2Pos.x + 15} y={p2Pos.y} textAnchor="middle" fontSize="20">üöÄ</text>
                <text x="150" y="20" textAnchor="middle" fontSize="30">üåô</text>
              </svg>
            </div>
          );
        }
      };

      return theme === 'classic' ? renderClassicBoard() : renderThemedBoard();
    }

    // Game Complete Modal Component
    function GameComplete({ winner, winnerName, isSkunk, player1Score, player2Score, sessionStats, onNewGame, onNewSession }) {
      return (
        <div className="modal-overlay">
          <div className="modal-content">
            <div className="trophy">{isSkunk ? 'üèÜüèÜ' : 'üèÜ'}</div>
            <div className="winner-name">{winnerName} Wins!</div>
            {isSkunk && <div className="skunk-message">SKUNK! (2 Game Wins)</div>}
            <div className="final-score">Final Score: {player1Score} - {player2Score}</div>
            <div className="session-standings">
              <h3>Session Standings</h3>
              <div className="score">{sessionStats.player1} - {sessionStats.player2}</div>
            </div>
            <div className="modal-actions">
              <button className="modal-btn primary" onClick={onNewGame}>
                Play Another Game
              </button>
              <button className="modal-btn secondary" onClick={onNewSession}>
                New Session (Different Players)
              </button>
            </div>
          </div>
        </div>
      );
    }

    // Main App Component
    function App() {
      const [appView, setAppView] = useState('home'); // 'home' or 'friends'
      const [session, setSession] = useState(null);
      const [currentGame, setCurrentGame] = useState(null);
      const [moves, setMoves] = useState([]);
      const [boardTheme, setBoardTheme] = useState('classic');
      const [showMenu, setShowMenu] = useState(false);
      const [error, setError] = useState(null);

      // Check authentication on mount
      useEffect(() => {
        const checkAuth = async () => {
          try {
            const response = await fetch('/api/auth-api.php?action=me', {
              credentials: 'include'
            });
            const data = await response.json();

            if (!data.success || !data.data) {
              // Not logged in - redirect to homepage
              window.location.href = '/index.html?return=' + encodeURIComponent(window.location.pathname);
            }
          } catch (error) {
            // Authentication failed - redirect to homepage
            window.location.href = '/index.html?return=' + encodeURIComponent(window.location.pathname);
          }
        };
        checkAuth();
      }, []);

      const player1Score = currentGame?.player1_score || 0;
      const player2Score = currentGame?.player2_score || 0;
      const scoreDiff = Math.abs(player1Score - player2Score);
      const player1Leading = player1Score > player2Score;

      // Find the most recent move for each player to show trailing peg correctly
      const player1Moves = moves.filter(m => m.player === 1);
      const player2Moves = moves.filter(m => m.player === 2);
      const player1LastPoints = player1Moves.length > 0 ? player1Moves[player1Moves.length - 1].points : 0;
      const player2LastPoints = player2Moves.length > 0 ? player2Moves[player2Moves.length - 1].points : 0;

      const sessionStats = {
        player1: session?.player1_total_wins || 0,
        player2: session?.player2_total_wins || 0
      };

      const handleStartSession = async (player1Name, player2Name, player1IsDealer = true) => {
        console.log('üü° handleStartSession called with:', { player1Name, player2Name, player1IsDealer });
        try {
          console.log('üü£ About to call api.createSession...');
          const data = await api.createSession({
            player1_name: player1Name,
            player2_name: player2Name,
            player1_is_dealer: player1IsDealer
          });
          console.log('‚úÖ Session created successfully:', data);
          setSession(data.session);
          setCurrentGame(data.game);
          setMoves([]);
        } catch (err) {
          console.error('‚ùå Error creating session:', err);
          setError(err.message);
          setTimeout(() => setError(null), 3000);
        }
      };

      const handleAddPoints = async (player, points) => {
        if (!currentGame || currentGame.is_complete) return;

        try {
          const data = await api.addMove(currentGame.id, { player, points });
          setCurrentGame(data.game);
          setMoves([...moves, data.move]);

          // Update session stats if game is complete
          if (data.game.is_complete && session) {
            const gamesWon = data.game.is_skunk ? 2 : 1;
            setSession({
              ...session,
              player1_total_wins: session.player1_total_wins + (data.game.winner === 1 ? gamesWon : 0),
              player2_total_wins: session.player2_total_wins + (data.game.winner === 2 ? gamesWon : 0)
            });
          }
        } catch (err) {
          setError(err.message);
          setTimeout(() => setError(null), 3000);
        }
      };

      const handleUndo = async () => {
        if (moves.length === 0) return;

        try {
          const lastMoveId = moves[moves.length - 1].id;
          const data = await api.undoMove(lastMoveId);
          setCurrentGame(data.game);
          setMoves(moves.slice(0, -1));
        } catch (err) {
          setError(err.message);
          setTimeout(() => setError(null), 3000);
        }
      };

      const handleNewGame = async () => {
        setShowMenu(false);
        if (!session) return;

        try {
          const data = await api.createGame(session.id);
          setCurrentGame(data.game);
          setMoves([]);
        } catch (err) {
          setError(err.message);
          setTimeout(() => setError(null), 3000);
        }
      };

      const handleNewSession = () => {
        setShowMenu(false);
        setSession(null);
        setCurrentGame(null);
        setMoves([]);
        setBoardTheme('classic');
      };

      // Show friends screen if requested
      if (appView === 'friends') {
        return <FriendsScreen onBack={() => setAppView('home')} />;
      }

      // Show new game setup if no session
      if (!session) {
        return <NewGameSetup onStart={handleStartSession} onManageFriends={() => setAppView('friends')} />;
      }

      return (
        <>
          <div className="header">
            <h1>Cribbage Scoring</h1>
            <div className="theme-selector">
              <select value={boardTheme} onChange={(e) => setBoardTheme(e.target.value)}>
                <option value="classic">Classic Board</option>
                <option value="mountain">Mountain Climb</option>
                <option value="skiing">Skiing</option>
                <option value="moon">Moon Flight</option>
              </select>
              <button className="btn btn-secondary" onClick={() => setShowMenu(!showMenu)}>
                Menu
              </button>
            </div>
          </div>

          <div className="game-screen">
            <PlayerPanel
              player="1"
              name={session.player1_name}
              score={player1Score}
              lastPoints={player1LastPoints}
              isLeading={player1Leading}
              scoreDiff={scoreDiff}
              player1Score={player1Score}
              player2Score={player2Score}
              onAddPoints={(pts) => handleAddPoints(1, pts)}
              onUndo={handleUndo}
            />

            <div className="board-container">
              <CribbageBoard
                player1Score={player1Score}
                player2Score={player2Score}
                player1LastPoints={player1LastPoints}
                player2LastPoints={player2LastPoints}
                sessionWins={sessionStats}
                theme={boardTheme}
              />
              <div className="game-info">
                Game {currentGame?.game_number || 0}
              </div>
            </div>

            <PlayerPanel
              player="2"
              name={session.player2_name}
              score={player2Score}
              lastPoints={player2LastPoints}
              isLeading={!player1Leading && player2Score > player1Score}
              scoreDiff={scoreDiff}
              player1Score={player1Score}
              player2Score={player2Score}
              onAddPoints={(pts) => handleAddPoints(2, pts)}
              onUndo={handleUndo}
            />
          </div>

          {currentGame?.is_complete && (
            <GameComplete
              winner={currentGame.winner}
              winnerName={currentGame.winner === 1 ? session.player1_name : session.player2_name}
              isSkunk={currentGame.is_skunk}
              player1Score={player1Score}
              player2Score={player2Score}
              sessionStats={sessionStats}
              onNewGame={handleNewGame}
              onNewSession={handleNewSession}
            />
          )}

          {showMenu && (
            <div className="modal-overlay" onClick={() => setShowMenu(false)}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                <h2>Menu</h2>
                <div className="modal-actions">
                  <button className="modal-btn primary" onClick={handleNewGame}>
                    Start New Game
                  </button>
                  <button className="modal-btn secondary" onClick={handleNewSession}>
                    New Session (Different Players)
                  </button>
                  <button className="modal-btn secondary" onClick={() => setShowMenu(false)}>
                    Cancel
                  </button>
                </div>
              </div>
            </div>
          )}

          {error && (
            <div style={{
              position: 'fixed',
              bottom: '1rem',
              right: '1rem',
              background: '#dc2626',
              color: 'white',
              padding: '1rem 1.5rem',
              borderRadius: '0.5rem',
              boxShadow: '0 4px 12px rgba(0, 0, 0, 0.2)'
            }}>
              {error}
            </div>
          )}
        </>
      );
    }

    // Render app
    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
